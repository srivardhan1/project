<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Posts</title>
    <link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.0.1/css/bootstrap.min.css"
        integrity="sha512-Ez0cGzNzHR1tYAv56860NLspgUGuQw16GiOOp/I2LuTmpSK9xDXlgJz3XN4cnpXWDmkNBKXR/VDMTCnAaEooxA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
        integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.css"
        integrity="sha512-6S2HWzVFxruDlZxI3sXOZZ4/eJ8AcxkQH1+JjSe/ONCEqR9L4Ysq5JdT5ipqtzU7WHalNwzwBv+iE51gNHJNqQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body style="background-color:rgb(41, 21, 21);" >
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top" id="signedInPost">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Dev-Client</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarColor01"
                aria-controls="navbarColor01" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarColor01">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/profile.html">Profile</a>
                    </li>
                </ul>
            </div>
    </nav>
    <div class="container-fluid gedf-wrapper" style="padding-top:60px;">
        <div class="row">
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body">
                        <div class="h5">Dev-Client</div>
                        <div class="h7 text-muted">   </div>
                        <div class="h7">

                        </div>
                    </div>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">
                            <div class="h6 text-muted">    </div>
                            <div class="h5">   </div>
                        </li>
                        <li class="list-group-item">
                            <div class="h6 text-muted">     </div>
                            <div class="h5">       </div>
                        </li>
                        <li class="list-group-item">     </li>
                    </ul>
                </div>
            </div>
            <div class="col-md-6 gedf-main">

                <!--- \\\\\\\Post-->
                <div class="card gedf-card">
                    <div class="card-header">
                        <ul class="nav nav-tabs card-header-tabs" id="myTab" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" id="posts-tab" data-toggle="tab" href="#posts" role="tab"
                                    aria-controls="posts" aria-selected="true" color="black">Make
                                    a publication</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="images-tab" data-toggle="tab" role="tab" aria-controls="images"
                                    aria-selected="false" href="#images">Images</a>
                            </li>
                        </ul>
                    </div>

                    <div class="card-body">
                        <div class="tab-content" id="myTabContent">
                            <div class="tab-pane fade show active" id="posts" role="tabpanel"
                                aria-labelledby="posts-tab">
                                <div class="form-group">
                                    <label class="sr-only" for="message">post</label>
                                    <textarea class="form-control" id="exampleTextarea" rows="3"
                                        placeholder="Title"></textarea>
                                </div>
                                <div class="form-group">
                                    <label class="sr-only" for="message">post</label>
                                    <textarea class="form-control" id="txt" rows="3"
                                        placeholder="Requirements"></textarea>
                                </div>

                            </div>
                            <div class="tab-pane fade" id="images" role="tabpanel" aria-labelledby="images-tab">
                                <div class="form-group">
                                    <div class="custom-file">
                                        <form action="/uploadposts" enctype="multipart/form-data" method="POST" target="uploader_iframe">
                                            <input type="file" class="custom-file-input" id="customFile" name="image">
                                            <label class="custom-file-label" for="customFile">Upload image</label>
                                            <input type="submit" value="save" onclick="uploaded()">
                                        </form>
                                        <iframe id="uploader_iframe" name="uploader_iframe" style="display: none;"></iframe>
                                    </div>
                                </div>
                                <div class="py-4"></div>
                            </div>
                        </div>
                        <div class="btn-toolbar justify-content-between">
                            <div class="btn-group">
                                <button type="submit" class="btn btn-primary" id="btn" onclick="shared()">share</button>
                            </div>
                            <div class="btn-group">
                                <button id="btnGroupDrop1" type="button" class="btn btn-link dropdown-toggle"
                                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <i class="fa fa-globe"></i>
                                </button>
                                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="btnGroupDrop1">
                                    <a class="dropdown-item" href="#"><i class="fa fa-globe"></i> Public</a>
                                    <a class="dropdown-item" href="#"><i class="fa fa-users"></i> Friends</a>
                                    <a class="dropdown-item" href="#"><i class="fa fa-user"></i> Just me</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Post /////-->

                <!--- \\\\\\\Post-->
                <div class="card gedf-card" id="post" style="background-color: white;">

                </div>
            </div>
        </div>
        
        <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet"
            id="bootstrap-css">
        <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <!------ Include the above in your HEAD tag ---------->

        <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"
            integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
            integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
            crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
            integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
            crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
            integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
            crossorigin="anonymous"></script>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
            integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.0.1/js/bootstrap.min.js"
            integrity="sha512-EKWWs1ZcA2ZY9lbLISPz8aGR2+L7JVYqBAYTq5AXgBkSjRSuQEGqWx8R1zAX16KdXPaCjOCaKE8MCpU0wcHlHA=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.js"
            integrity="sha512-lbwH47l/tPXJYG9AcFNoJaTMhGvYWhVM9YI43CT+uteTRRaiLCui8snIgyAN8XWgNjNhCqlAUdzZptso6OCoFQ=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="/javascripts/site.js"></script>
</body>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script>

function uploaded(){
    toastr.success( 'Updated successfully');
}

function shared(){
    toastr.success( 'Shared successfully');
}

$.ajax({
        url: "/getposts",
        type: "GET",
        success: function (data) {
            console.log("hi");
            if (data.result) {
                window.localStorage.setItem('project', JSON.stringify(data.projects));
                var obj = JSON.parse(window.localStorage.getItem('project'));
                for (var i = 0; i < data.projects.length; i++) {

                    var id = data.projects[i].postedBy;
                    //console.log(id)
                    $.ajax({
                        url: "/postuserdetails" + id,
                        type: "GET",
                        success: function (details) {
                          
                            //console.log(details);
                            if (details.success) {
                              var obj = JSON.parse(window.localStorage.getItem('project'));
                              var post=[];
                              
                              for (j=0;j<obj.length;j++){
                                if(obj[j].postedBy==details.users._id){
                                  post.push(obj[j]);
                                   obj[j].postedBy="0";
                                } 
                              }
                              console.log(post);
                     
                                for(k=0;k<post.length;k++){
                                $("#post").append(`<div style="padding-top:70px;" class="card gedf-card" id="post"><div class="card-header"><div class="d-flex justify-content-between align-items-center"><div class="d-flex justify-content-between align-items-center"><div class="mr-2"><img class="rounded-circle" width="45" src='data:image/png;base64,${details.users.image}' alt=""></div><div class="ml-2"><div class="h5 m-0">${details.users.username}</div><div class="h7 text-muted">${details.users.role}</div></div></div><div><div class="dropdown"><button class="btn btn-link dropdown-toggle" type="button" id="gedf-drop1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fa fa-ellipsis-h"></i></button><div class="dropdown-menu dropdown-menu-right" aria-labelledby="gedf-drop1"><div class="h6 dropdown-header">Configuration</div><a class="dropdown-item" href="#">Save</a><a class="dropdown-item" href="#">Hide</a><a class="dropdown-item" href="#">Report</a></div></div></div></div></div><div class="card-body"><div class="text-muted h7 mb-2"><p> 
                                  <h3><b>Title</b></h3>${post[k].title}</p><p><h3><b>Requirements</b></h3>${post[k].requirement}</p><h3>Contact Details</h3><p>Mail id: ${details.users.email}</p><p>Phone Number : ${details.users.phonenumber}</p></div> <a class="card-link" href="#"><h5 class="card-title"></h5></a><p class="card-text"></p></div><div class="card-footer"><a href="#" class="card-link"><i class="fa fa-gittip"></i> Like</a><a href="#" class="card-link"><i class="fa fa-comment"></i> Comment</a><a href="#" class="card-link"><i class="fa fa-mail-forward"></i> Share</a></div></div>`);
                                //toastr.success( 'Updated successfully');
                                window.localStorage.setItem('project',JSON.stringify(obj));
                                }
                                

                               

                            }
                        },
                        error: function (xhr, status, error) {
                            //alert(error);
                        }
                    });
                }
                //console.log(data);


                //console.log(data);
                //toastr.success( 'Updated successfully');
            }
        },
        error: function (xhr, status, error) {
            //alert(error);
        }
    });

$.ajax({
        url: "/getprojects",
        type: "GET",
        success: function (data) {
            //console.log("hi");
            //console.log(data);
            if (data.result) {
                window.localStorage.setItem('posts', JSON.stringify(data.posts));
                var obj = JSON.parse(window.localStorage.getItem('posts'));
                for (var i = 0; i < data.posts.length; i++) {
                    var id = data.posts[i].postedBy;
                    console.log(id);
                    $.ajax({
                        
                        url: "/postuserdetails" + id,
                        type: "GET",
                        success: function (details) {
                            console.log(details);
                            
                            if (details.success) {
                                
                              var obj = JSON.parse(window.localStorage.getItem('posts'));
                              var post=[];
                              
                              for (j=0;j<obj.length;j++){
                                if(obj[j].postedBy==details.users._id){
                                  post.push(obj[j]);
                                   obj[j].postedBy="0";
                                } 
                              }
                              console.log(post);
                     
                                for(k=0;k<post.length;k++){
                                $("#post").append(`<div style="padding-top:70px;" class="card gedf-card" id="post"><div class="card-header"><div class="d-flex justify-content-between align-items-center"><div class="d-flex justify-content-between align-items-center"><div class="mr-2">
                                    <img class="rounded-circle" width="45" src='data:image/png;base64,${details.users.image}' alt=""></div><div class="ml-2"><div class="h5 m-0">${details.users.username}</div><div class="h7 text-muted">Developer</div></div></div><div><div class="dropdown"><button class="btn btn-link dropdown-toggle" type="button" id="gedf-drop1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fa fa-ellipsis-h"></i></button><div class="dropdown-menu dropdown-menu-right" aria-labelledby="gedf-drop1"><div class="h6 dropdown-header">Configuration</div><a class="dropdown-item" href="#">Save</a><a class="dropdown-item" href="#">Hide</a><a class="dropdown-item" href="#">Report</a></div></div></div></div></div><div class="card-body"><div class="text-muted h7 mb-2"><p> 
                                        <img  width="600px" height="300px" src='data:image/png;base64,${post[k].image}' alt=""> </div> <a class="card-link" href="#"><h5 class="card-title"></h5></a><p class="card-text"></p></div><div class="card-footer"><a href="#" class="card-link"><i class="fa fa-gittip"></i> Like</a><a href="#" class="card-link"><i class="fa fa-comment"></i> Comment</a><a href="#" class="card-link"><i class="fa fa-mail-forward"></i> Share</a></div></div>`);
                                //toastr.success( 'Updated successfully');
                                window.localStorage.setItem('posts',JSON.stringify(obj));
                                }
                                

                               

                            }
                        },
                        error: function (xhr, status, error) {
                            //alert(error);
                        }
                    });
                }
                //console.log(data);


                //console.log(data);
                //toastr.success( 'Updated successfully');
            }
        },
        error: function (xhr, status, error) {
            //alert(error);
        }
    });

    $("#btn").on('click', function (e) {
        e.preventDefault();
        e.stopPropagation();
        var value = document.getElementById('exampleTextarea').value;
        var text = document.getElementById('txt').value;

        var userposts = {}
        userposts.requirement = text;
        userposts.title = value;
        console.log(userposts);
        $.ajax({

            url: "/posts",
            type: "POST",
            data: userposts,
            success: function (data) {
                //console.log("hi");
                if (data.success) {
                    console.log(data);


                    //console.log(data);
                    //toastr.success( 'Updated successfully');
                }
            },
            error: function (xhr, status, error) {
                //alert(error);
            }
        });
        //let div = document.createElement('div');
    })
    var userObject = {
        saveUserInLocalStorage: function (userJson) {
            window.localStorage.setItem('currentUser', JSON.stringify(userJson));
        },
        saveTitleInLocalStorage: function (userJson) {
            window.localStorage.setItem('title', JSON.stringify(userJson));
        },
        saveRequireInLocalStorage: function (userJson) {
            window.localStorage.setItem('requirements', JSON.stringify(userJson));
        },
        removeCurrentUser: function () {
            window.localStorage.removeItem('currentUser');
        },
        getCurrentUser: function () {
            return window.localStorage.getItem('currentUser');
        },
        getCurrentUserName: function () {
            var curUserString = this.getCurrentUser();
            if (curUserString) {
                var json = JSON.parse(curUserString);
                if (json && json.username)
                    return json.username;
                return "";
            }
            return "";
        },
        isUserLoggedIn: function () {
            if (this.getCurrentUser() == null)
                return false;
            return true;
        }
    };
    var username = userObject.getCurrentUserName();

</script>
</html>